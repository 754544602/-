/**
 *
 * 创建当前业务对象
 * 当前给出的是示例，研发中根据自己的业务进行创建
 * 命名规范:驼峰命名，首字母小写，后面加上Obj结束
 */
var loanApplyObj={init:function(){$(".main-model").css("min-height",$(window).height()-12);$("select").niceSelect();loanApplyObj.selectChangeFun();loanApplyObj.setAddsafselect();loanApplyObj.dataInit();loanApplyObj.getBrowseRecordListByParams();},events:function(){$('.query-btn').click(function(){loanApplyObj.getBrowseRecordListByParams()});$('.assist-btn').click(function(){$("#txtDate1,#txtDate2").val('');$("select.select-safe option:eq(0),select.select-code option:eq(0)").attr("selected","selected");$('select.select-name').html('<option value="" selected="selected">全部</option>');$("select").niceSelect();loanApplyObj.getBrowseRecordListByParams()})},dataInit:function(){$("#txtDate1").calendar({speed:0,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:false,dateFmt:"yyyy-MM",callback:function(){}});$("#txtDate2").calendar({speed:0,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:false,dateFmt:"yyyy-MM",callback:function(){}})},getBrowseRecordListByParams:function(){var parentCode=$('.select-code').val()==null?"":$('.select-code').val();var chilCode=$('.select-name').val()==null?"":$('.select-name').val();if(parentCode!=""&&chilCode!=""){parentCode="."+parentCode+"."+chilCode+"."}else if(parentCode!=""){parentCode="."+parentCode+"."}var widgetItem=parentCode;var browseStaff=$('.select-safe').val();var startDate=$("#txtDate1").val();var endDate=$('#txtDate2').val();var pageIndex=1;var pageNum=15;$('.table-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,type:"post",async:false,url:"widget/browse/getBrowseRecordListByParams",data:{widgetItem:widgetItem,browseStaff:browseStaff,startDate:startDate,endDate:endDate,pageIndex:pageIndex,pageNum:pageNum},objName:'data',success:function(data){if(data.flag==0){$(".payment-table tbody").empty();var trStr="";if(data.data.rows.length>0){$(".table-page").show();$.each(data.data.rows,function(i,n){trStr+='<tr><td style="text-align: left;">('+n.widgetCode+")"+n.widgetName+'</td><td>'+n.browseStaff+'</td><td>'+n.browsingTime+'</td></tr>'});$(".payment-table tbody").append(trStr)}else{$(".table-page").hide();$(".payment-table tbody").append(sysCommon.noDataTrStr(3))}}},isSelPageNum:true })},selectChangeFun:function(){var me=this;me.setAddselect($('select.select-code'),'',function(list){var code=$('select.select-code').find('option:selected').val();if(code){me.setAddselect($('select.select-name'),code)}});$('select.select-code').on('change',function(){var code=$(this).find('option:selected').val();if(code){me.setAddselect($('select.select-name'),code)}})},setAddselect:function(obj,parentCode,fun){$.ajax({type:"post",url:"widget/browse/getWidgetMainListByParams",async:true,data:{parentCode:parentCode},success:function(data){var list=data.data;obj.empty();obj.html('<option value="" selected="selected">全部</option>');var selected='';$.each(list,function(i,n){obj.append('<option value="'+n.widgetCode+'" '+selected+'>'+n.widgetName+'('+n.widgetCode+')</option>')});obj.niceSelect();if(fun){fun(list)}}})},setAddsafselect:function(){$.ajax({type:"post",url:"widget/browse/getBrowseStaffListByParams",async:true,success:function(data){var datas=data.data;var selected='';$.each(datas,function(i,n){selected='';if(n.parentCode=='0'){$('.select-safe').append('<option value="'+n.borwseSaffCode+'" '+selected+'>'+n.borwseSaff+'</option>')}else{$('.select-safe').append('<option value="'+n.borwseSaffCode+'">'+n.borwseSaff+'</option>')}});$(".select-safe").niceSelect()}})}};$(function(){loanApplyObj.init();loanApplyObj.events()});