var dictionaryTree={dictingaryTreeDate:[],init:function(){$("select").niceSelect();$("#dictionaryTree").css("min-height",$(window).height()-55+"px");dictionaryTree.events();dictionaryTree.getBudgetDataInfo()},events:function(){$("#addDictionary").on("click",function(){dictionaryTree.showAddPop()});$("#editDictionary").on("click",function(){var thisTr=$(".datagrid-view2 .datagrid-row.datagrid-row-checked");var selTrLen=$(".datagrid-view2 .datagrid-row.datagrid-row-checked").length;if(selTrLen>0){dictionaryTree.showAddPop(thisTr)}else{$yt_alert_Model.prompt("请选择一行数据进行操作")}});$("#dictionaryTree").off().on("click",".datagrid-row",function(){var thisObj=$(this);var trState=thisObj.find(".datagrid-cell-c2-status .status-span").text();if(trState=="启用"){$("#blockUpBtn").text("停用")}else{$("#blockUpBtn").text("启用")}});$("#switchoverBtn").on("click",function(){var thisBtn=$(this);if(thisBtn.text()=='展开'){$('#budgetTab').treegrid("expandAll");thisBtn.text("折叠")}else{$('#budgetTab').treegrid('collapseAll');thisBtn.text("展开")}})},showAddPop:function(thisTr){if(thisTr){$('#dictionaryPop .serv-btn').show();$('#dictionaryPop .sure-btn').hide();var widgetCode=thisTr.find(".datagrid-cell-c2-widgetCode .dict-type-code").text();var widgetName=thisTr.find(".datagrid-cell-c2-widgetName .dis-value").text();var parentInput=thisTr.find("input.parent-type-code").val();var parentArr=parentInput.split(',');$("#widgetCode").val(widgetCode).attr("disabled",true);$("#widgetName").val(widgetName);$("#parentTree").val(parentArr[1]);$("#parentCode").val(parentArr[0])}else{$('#dictionaryPop .serv-btn').hide();$('#dictionaryPop .sure-btn').show()}$("#dictionaryPop,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#dictionaryPop"));$('#dictionaryPop .serv-btn').off().on("click",function(){var isTrue=$yt_valid.validForm($("#dictionaryPop"));if(isTrue){var widgetCode=$("#widgetCode").val();var widgetName=$("#widgetName").val();var parentTree=$("#parentTree").val();var parTypeCode=$("#parentCode").val();$.ajax({type:"post",url:"widget/main/updateWidgetMain",async:true,data:{widgetCode:widgetCode,widgetName:widgetName,parentCode:parTypeCode},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);$("#parentTree,#widgetName,#widgetCode").val("").removeClass("valid-hint");$("#widgetCode").attr("disabled",false);$(".valid-font").text("");$("#parentTree").click(function(){var thisBtn=$(this);thisBtn.toggleClass("open")});$("#dictionaryPop,#heard-nav-bak").hide();$("#pop-modle-alert").hide();dictionaryTree.getBudgetDataInfo()}else{$yt_alert_Model.prompt(data.message)}}})}});$('#dictionaryPop .sure-btn').off().on("click",function(){var isTrue=$yt_valid.validForm($("#dictionaryPop"));if(isTrue){var widgetCode=$("#widgetCode").val();var widgetName=$("#widgetName").val();var parentTree=$("#parentTree").val();var parTypeCode=$("#parentCode").val();$.ajax({type:"post",url:"widget/main/addWidgetMain",async:true,data:{widgetCode:widgetCode,widgetName:widgetName,parentCode:parTypeCode},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);$("#parentTree,#widgetName,#widgetCode").val("").removeClass("valid-hint");$(".valid-font").text("");$("#parentTree").click(function(){var thisBtn=$(this);thisBtn.toggleClass("open")});$("#dictionaryPop,#heard-nav-bak").hide();$("#pop-modle-alert").hide();dictionaryTree.getBudgetDataInfo()}else{$yt_alert_Model.prompt(data.message)}}})}});$('#dictionaryPop .yt-model-canel-btn').off().on("click",function(){$("#parentTree,#widgetName,#widgetCode").val("").removeClass("valid-hint");$("#widgetCode").attr("disabled",false);$(".valid-font").text("");$("#dictionaryPop,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},createTreeData:function(){$('#parentTree').removeClass("tree-input");$('#parentTree').removeClass("open");$('#treeDiv').remove();$('#parentTree').createTree({controlId:'treeDiv',dataList:dictionaryTree.dictingaryTreeDate,rootConfig:{id:"0",pid:"-1",name:"数据字典"},listConfig:{id:'widgetCode',pid:'parentCode',name:'widgetName'},speed:0,hide:true,callback:{onClick:dictionaryTree.getNode }})},getNode:function(obj,id,name){$('#parentTree').val(name);$('#parentCode').val(id)},getBudgetDataInfo:function(){$.ajax({type:"post",url:"widget/main/getWidgetMainListByParams",async:true,data:{},success:function(data){if(data.flag==0){var datas=dictionaryTree.getTreeData(data.data,'0',"widgetCode","parentCode");$('#budgetTab').treegrid("loadData",datas);var thisArr=data.data;dictionaryTree.dictingaryTreeDate=thisArr;dictionaryTree.createTreeData()}else{$yt_alert_Model.prompt(data.message)}}})},getTreeData:function(data,parentId,code,parentCode){code=code?code:'id';parentCode=parentCode?parentCode:'parentId';var me=this;var result=[],temp;for(var i in data){if(data[i][parentCode]==parentId){result.push(data[i]);temp=me.getTreeData(data,data[i][code],code,parentCode);if(temp.length>0){data[i].children=temp}}}return result},eventInit:function(){}};$(function(){dictionaryTree.init();$('#budgetTab').treegrid({idField:'widgetCode',treeField:'widgetCode',columns:[[{title:'CODE',field:'widgetCode',width:'50%',align:'center',formatter:function(value,row,index,num){return '<input type="hidden" class="parent-type-code" value="'+(row.parentCode==0?'0,数据字典':(row.parentCode+','+row.parentCodeName))+'"/><span class="dict-type-code">'+value+'</span>'}},{title:'名称',field:'widgetName',width:'51%',align:'center',formatter:function(value,row,index,num){return '<span class="dis-value">'+value+'</span>'}}]]})});